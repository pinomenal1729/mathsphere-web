<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>MathSphere v8.0 â€” The Mathematical Lab</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css"/>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/2.26.0/plotly.min.js"></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LUXURY MATHEMATICAL LAB AESTHETIC
   Premium dark theme with glowing elements and geometric accents
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

:root {
  /* Premium color palette */
  --bg-deep: #0a0e27;
  --bg-main: #0f1437;
  --bg-light: #14194f;
  --accent-primary: #00d9ff;
  --accent-secondary: #7c3aed;
  --accent-tertiary: #06f7d6;
  --text-primary: #f8fafc;
  --text-secondary: #a8b7d1;
  --text-tertiary: #6b7a94;
  --gold: #d4a574;
  --danger: #ff6b6b;
  
  /* Typography */
  --font-display: 'Playfair Display', serif;
  --font-body: 'Poppins', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  height: 100%;
  background: linear-gradient(135deg, var(--bg-deep) 0%, #1a1f4b 100%);
  color: var(--text-primary);
  font-family: var(--font-body);
  font-size: 14px;
  line-height: 1.65;
  overflow: hidden;
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><circle cx="10" cy="10" r="3" fill="%2300d9ff"/><circle cx="10" cy="10" r="8" fill="none" stroke="%2300d9ff" stroke-width="1"/></svg>') 10 10, auto;
}

/* â•â•â•â• ANIMATED BACKGROUND â•â•â•â• */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  background: 
    radial-gradient(circle at 20% 80%, rgba(0, 217, 255, 0.15) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(124, 58, 237, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 50% 50%, rgba(6, 247, 214, 0.05) 0%, transparent 50%);
  animation: gradientShift 15s ease-in-out infinite;
}

@keyframes gradientShift {
  0%, 100% { filter: blur(40px); }
  50% { filter: blur(60px); opacity: 1; }
}

/* Grid pattern overlay */
body::after {
  content: '';
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  background-image: 
    linear-gradient(0deg, transparent 24%, rgba(0, 217, 255, .05) 25%, rgba(0, 217, 255, .05) 26%, transparent 27%, transparent 74%, rgba(0, 217, 255, .05) 75%, rgba(0, 217, 255, .05) 76%, transparent 77%, transparent),
    linear-gradient(90deg, transparent 24%, rgba(0, 217, 255, .05) 25%, rgba(0, 217, 255, .05) 26%, transparent 27%, transparent 74%, rgba(0, 217, 255, .05) 75%, rgba(0, 217, 255, .05) 76%, transparent 77%, transparent);
  background-size: 60px 60px;
  opacity: 0.3;
}

/* Floating mathematical symbols */
.math-float {
  position: fixed;
  font-size: 80px;
  opacity: 0.04;
  pointer-events: none;
  z-index: 0;
  animation: float 20s infinite ease-in-out;
  font-family: var(--font-mono);
  color: var(--accent-primary);
}

@keyframes float {
  0%, 100% { transform: translateY(0) translateX(0) rotate(0deg); }
  50% { transform: translateY(-20px) translateX(10px) rotate(180deg); }
}

/* â•â•â•â• LAYOUT â•â•â•â• */
#app {
  position: relative;
  z-index: 1;
  display: flex;
  height: 100vh;
  max-width: 1400px;
  margin: 0 auto;
}

/* â•â•â•â• SIDEBAR â•â•â•â• */
#sidebar {
  width: 260px;
  flex-shrink: 0;
  background: rgba(10, 14, 39, 0.8);
  backdrop-filter: blur(20px);
  border-right: 1px solid rgba(0, 217, 255, 0.1);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
  box-shadow: inset -1px 0 0 rgba(0, 217, 255, 0.05);
}

#sidebar:hover {
  box-shadow: inset -2px 0 0 rgba(0, 217, 255, 0.15), -10px 0 30px rgba(0, 217, 255, 0.1);
}

/* Logo section with glow */
.logo-wrap {
  padding: 24px 18px;
  border-bottom: 1px solid rgba(0, 217, 255, 0.1);
  display: flex;
  align-items: center;
  gap: 14px;
  background: linear-gradient(135deg, rgba(0, 217, 255, 0.05) 0%, rgba(124, 58, 237, 0.05) 100%);
}

.logo-icon {
  width: 48px;
  height: 48px;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  box-shadow: 0 0 30px rgba(0, 217, 255, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
  animation: glow 3s ease-in-out infinite;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

@keyframes glow {
  0%, 100% { box-shadow: 0 0 20px rgba(0, 217, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1); }
  50% { box-shadow: 0 0 40px rgba(0, 217, 255, 0.6), 0 0 80px rgba(124, 58, 237, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2); }
}

.logo-name {
  font-family: var(--font-display);
  font-size: 18px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-primary) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -1px;
}

.logo-by {
  font-size: 10px;
  color: var(--text-tertiary);
  font-family: var(--font-mono);
  letter-spacing: 1.5px;
  text-transform: uppercase;
}

/* Navigation */
.sb-scroll {
  flex: 1;
  overflow-y: auto;
  padding: 12px 10px;
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 217, 255, 0.3) transparent;
}

.sb-scroll::-webkit-scrollbar {
  width: 6px;
}

.sb-scroll::-webkit-scrollbar-track {
  background: transparent;
}

.sb-scroll::-webkit-scrollbar-thumb {
  background: rgba(0, 217, 255, 0.3);
  border-radius: 3px;
}

.sb-scroll::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 217, 255, 0.6);
}

.sb-section {
  padding: 12px 12px 6px;
  font-size: 9px;
  color: var(--text-tertiary);
  font-family: var(--font-mono);
  letter-spacing: 2px;
  text-transform: uppercase;
  margin-top: 8px;
}

.nav-btn {
  display: flex;
  align-items: center;
  gap: 12px;
  width: 100%;
  padding: 11px 14px;
  border: none;
  background: rgba(0, 217, 255, 0);
  color: var(--text-secondary);
  cursor: pointer;
  border-radius: 10px;
  font-family: var(--font-body);
  font-size: 13px;
  font-weight: 500;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  text-align: left;
  position: relative;
  overflow: hidden;
  margin: 2px 0;
}

.nav-btn::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
  transform: scaleY(0);
  transition: transform 0.3s ease;
  border-radius: 0 3px 3px 0;
}

.nav-btn::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(0, 217, 255, 0.1) 0%, rgba(124, 58, 237, 0.1) 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
  border-radius: 10px;
  z-index: -1;
}

.nav-btn:hover {
  color: var(--text-primary);
  transform: translateX(6px);
  background: rgba(0, 217, 255, 0.05);
}

.nav-btn:hover::after {
  opacity: 1;
}

.nav-btn.active {
  background: rgba(0, 217, 255, 0.12);
  color: var(--accent-primary);
  border: 1px solid rgba(0, 217, 255, 0.3);
  box-shadow: 0 0 20px rgba(0, 217, 255, 0.2), inset 0 0 20px rgba(0, 217, 255, 0.05);
}

.nav-btn.active::before {
  transform: scaleY(1);
}

.nav-btn .em {
  font-size: 16px;
  transition: transform 0.3s ease;
}

.nav-btn:hover .em {
  transform: scale(1.25) rotate(-8deg);
}

/* â•â•â•â• MAIN CONTENT â•â•â•â• */
#main {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden;
  min-width: 0;
}

/* Top bar */
#topbar {
  display: flex;
  align-items: center;
  gap: 14px;
  padding: 14px 24px;
  border-bottom: 1px solid rgba(0, 217, 255, 0.1);
  background: rgba(10, 14, 39, 0.6);
  backdrop-filter: blur(20px);
  flex-shrink: 0;
  box-shadow: 0 4px 30px rgba(0, 217, 255, 0.05);
}

#mode-title {
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 18px;
  background: linear-gradient(135deg, var(--text-primary), var(--accent-primary));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  transition: all 0.25s ease;
  flex: 1;
}

.status-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-tertiary), var(--accent-primary));
  box-shadow: 0 0 15px var(--accent-tertiary), 0 0 30px rgba(0, 217, 255, 0.5);
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.2); opacity: 0.7; }
}

/* Buttons in top bar */
#clear-btn, #theme-btn {
  background: rgba(0, 217, 255, 0.08);
  border: 1px solid rgba(0, 217, 255, 0.3);
  color: var(--text-secondary);
  padding: 7px 14px;
  border-radius: 8px;
  font-family: var(--font-mono);
  font-size: 11px;
  cursor: pointer;
  transition: all 0.3s ease;
  letter-spacing: 0.5px;
}

#clear-btn:hover, #theme-btn:hover {
  background: rgba(0, 217, 255, 0.15);
  border-color: var(--accent-primary);
  color: var(--accent-primary);
  box-shadow: 0 0 15px rgba(0, 217, 255, 0.3);
  transform: translateY(-2px);
}

#owner-name {
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 12px;
  color: var(--accent-tertiary);
  padding: 6px 12px;
  border: 1px solid rgba(6, 247, 214, 0.3);
  border-radius: 999px;
  background: rgba(6, 247, 214, 0.08);
  box-shadow: 0 0 10px rgba(6, 247, 214, 0.2);
}

/* Tags bar */
#tagsbar {
  display: flex;
  gap: 10px;
  padding: 12px 24px;
  border-bottom: 1px solid rgba(0, 217, 255, 0.1);
  background: rgba(20, 25, 79, 0.4);
  overflow-x: auto;
  flex-shrink: 0;
  scrollbar-width: none;
}

#tagsbar::-webkit-scrollbar {
  display: none;
}

.tag {
  background: rgba(0, 217, 255, 0.08);
  border: 1px solid rgba(0, 217, 255, 0.25);
  color: var(--text-secondary);
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 11px;
  font-family: var(--font-mono);
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.3s ease;
}

.tag:hover {
  background: rgba(0, 217, 255, 0.18);
  border-color: var(--accent-primary);
  color: var(--accent-primary);
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0, 217, 255, 0.25);
}

/* Chat area */
#chat {
  flex: 1;
  overflow-y: auto;
  padding: 24px;
  display: flex;
  flex-direction: column;
  gap: 18px;
  scrollbar-width: thin;
  scrollbar-color: rgba(0, 217, 255, 0.2) transparent;
}

#chat::-webkit-scrollbar {
  width: 6px;
}

#chat::-webkit-scrollbar-thumb {
  background: rgba(0, 217, 255, 0.2);
  border-radius: 3px;
}

#chat::-webkit-scrollbar-thumb:hover {
  background: rgba(0, 217, 255, 0.4);
}

/* Messages */
.msg {
  display: flex;
  gap: 12px;
  animation: msgSlideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes msgSlideIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.msg.user {
  flex-direction: row-reverse;
}

.avatar {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
  font-weight: bold;
}

.msg.user .avatar {
  background: linear-gradient(135deg, #1a2d5c 0%, #2a1f4f 100%);
  border: 1px solid rgba(124, 58, 237, 0.3);
  box-shadow: 0 0 15px rgba(124, 58, 237, 0.2);
}

.msg.bot .avatar {
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  box-shadow: 0 0 20px rgba(0, 217, 255, 0.4);
  border: 1px solid rgba(0, 217, 255, 0.3);
}

.bubble {
  max-width: 75%;
  padding: 14px 18px;
  border-radius: 16px;
  font-size: 13.5px;
  line-height: 1.8;
  position: relative;
  overflow-wrap: break-word;
  min-width: 0;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.msg.user .bubble {
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.12) 0%, rgba(0, 217, 255, 0.08) 100%);
  border: 1px solid rgba(124, 58, 237, 0.25);
  color: var(--text-primary);
  border-top-right-radius: 4px;
  box-shadow: 0 4px 20px rgba(124, 58, 237, 0.15);
}

.msg.user .bubble:hover {
  background: linear-gradient(135deg, rgba(124, 58, 237, 0.18) 0%, rgba(0, 217, 255, 0.12) 100%);
  box-shadow: 0 8px 30px rgba(124, 58, 237, 0.25);
}

.msg.bot .bubble {
  background: linear-gradient(135deg, rgba(0, 217, 255, 0.08) 0%, rgba(20, 25, 79, 0.5) 100%);
  border: 1px solid rgba(0, 217, 255, 0.2);
  color: var(--text-primary);
  border-top-left-radius: 4px;
  box-shadow: 0 4px 20px rgba(0, 217, 255, 0.15);
  position: relative;
}

.msg.bot .bubble::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 1.5px;
  background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary), transparent);
  border-radius: 16px 16px 0 0;
  opacity: 0.6;
}

.msg.bot .bubble:hover {
  background: linear-gradient(135deg, rgba(0, 217, 255, 0.12) 0%, rgba(20, 25, 79, 0.6) 100%);
  box-shadow: 0 8px 30px rgba(0, 217, 255, 0.25), inset 0 0 20px rgba(0, 217, 255, 0.05);
  border-color: rgba(0, 217, 255, 0.3);
}

.bubble code {
  font-family: var(--font-mono);
  font-size: 12px;
  background: rgba(0, 0, 0, 0.3);
  padding: 2px 6px;
  border-radius: 4px;
  color: var(--accent-tertiary);
  border: 1px solid rgba(6, 247, 214, 0.2);
}

.bubble pre {
  background: rgba(0, 0, 0, 0.4);
  border: 1px solid rgba(0, 217, 255, 0.2);
  border-radius: 8px;
  padding: 12px;
  margin: 10px 0;
  overflow-x: auto;
  font-family: var(--font-mono);
  font-size: 11px;
  line-height: 1.6;
  color: var(--accent-tertiary);
}

/* Input area */
#inputarea {
  padding: 16px 24px 20px;
  border-top: 1px solid rgba(0, 217, 255, 0.1);
  background: rgba(10, 14, 39, 0.6);
  backdrop-filter: blur(20px);
  flex-shrink: 0;
  z-index: 999;
  position: relative;
  margin-top: auto;
}

.inp-wrap {
  display: flex;
  gap: 10px;
  align-items: flex-end;
  background: rgba(20, 25, 79, 0.6);
  border: 1px solid rgba(0, 217, 255, 0.25);
  border-radius: 14px;
  padding: 10px 12px 10px 16px;
  transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 20px rgba(0, 217, 255, 0.1);
}

.inp-wrap:focus-within {
  border-color: var(--accent-primary);
  background: rgba(20, 25, 79, 0.8);
  box-shadow: 0 8px 40px rgba(0, 217, 255, 0.2), inset 0 0 20px rgba(0, 217, 255, 0.05);
}

#input {
  flex: 1;
  background: none;
  border: none;
  outline: none;
  color: var(--text-primary);
  font-family: var(--font-body);
  font-size: 13.5px;
  line-height: 1.6;
  resize: none;
  max-height: 120px;
  min-height: 24px;
}

#input::placeholder {
  color: var(--text-tertiary);
}

.iico {
  width: 36px;
  height: 36px;
  background: rgba(0, 217, 255, 0.1);
  border: 1px solid rgba(0, 217, 255, 0.2);
  border-radius: 8px;
  color: var(--text-tertiary);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  transition: all 0.3s ease;
  flex-shrink: 0;
}

.iico:hover {
  background: rgba(0, 217, 255, 0.2);
  border-color: var(--accent-primary);
  color: var(--accent-primary);
  transform: scale(1.1) rotate(-8deg);
  box-shadow: 0 4px 15px rgba(0, 217, 255, 0.25);
}

#send-btn {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  border: none;
  border-radius: 8px;
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  box-shadow: 0 4px 20px rgba(0, 217, 255, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  flex-shrink: 0;
}

#send-btn:hover {
  transform: scale(1.15) rotate(8deg);
  box-shadow: 0 8px 30px rgba(0, 217, 255, 0.5), 0 0 20px rgba(124, 58, 237, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

#send-btn:active {
  transform: scale(0.95);
}

#send-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  transform: none;
}

.inp-hint {
  text-align: center;
  margin-top: 8px;
  font-size: 10px;
  color: var(--text-tertiary);
  font-family: var(--font-mono);
  letter-spacing: 0.5px;
}

/* Welcome screen */
#welcome {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1;
  padding: 40px 20px;
  text-align: center;
  animation: welcomeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes welcomeIn {
  from {
    opacity: 0;
    transform: translateY(30px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.big-icon {
  width: 96px;
  height: 96px;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  border-radius: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  box-shadow: 0 20px 60px rgba(0, 217, 255, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.2);
  animation: iconFloat 4s ease-in-out infinite;
  margin-bottom: 32px;
  border: 2px solid rgba(255, 255, 255, 0.1);
}

@keyframes iconFloat {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50% { transform: translateY(-15px) rotate(5deg); }
}

#welcome h1 {
  font-family: var(--font-display);
  font-size: 36px;
  font-weight: 800;
  letter-spacing: -1.5px;
  margin-bottom: 12px;
  background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-primary) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

#welcome p {
  color: var(--text-secondary);
  max-width: 480px;
  font-size: 14px;
  line-height: 1.8;
  margin-bottom: 28px;
}

.feat-grid {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: center;
  max-width: 600px;
}

.feat {
  background: rgba(0, 217, 255, 0.08);
  border: 1px solid rgba(0, 217, 255, 0.2);
  border-radius: 10px;
  padding: 8px 14px;
  font-size: 11px;
  color: var(--text-secondary);
  font-family: var(--font-mono);
  cursor: default;
  transition: all 0.3s ease;
}

.feat:hover {
  background: rgba(0, 217, 255, 0.15);
  border-color: var(--accent-primary);
  color: var(--accent-primary);
  transform: translateY(-4px);
  box-shadow: 0 8px 20px rgba(0, 217, 255, 0.2);
}

.feat.new {
  border-color: rgba(6, 247, 214, 0.3);
  color: var(--accent-tertiary);
  background: rgba(6, 247, 214, 0.08);
}

/* Typography */
.katex {
  color: var(--text-primary);
  font-size: 1.04em;
}

.katex-display {
  margin: 12px 0;
  overflow-x: auto;
}

/* Toast notifications */
.toast {
  position: fixed;
  top: 20px;
  right: 20px;
  padding: 12px 18px;
  border-radius: 10px;
  font-size: 12px;
  z-index: 9999;
  font-family: var(--font-mono);
  animation: toastSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  backdrop-filter: blur(10px);
  border: 1px solid;
}

@keyframes toastSlide {
  from {
    opacity: 0;
    transform: translateX(100px) translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateX(0) translateY(0);
  }
}

.toast.ok {
  background: rgba(6, 247, 214, 0.12);
  border-color: rgba(6, 247, 214, 0.3);
  color: var(--accent-tertiary);
  box-shadow: 0 8px 30px rgba(6, 247, 214, 0.2);
}

.toast.info {
  background: rgba(0, 217, 255, 0.12);
  border-color: rgba(0, 217, 255, 0.3);
  color: var(--accent-primary);
  box-shadow: 0 8px 30px rgba(0, 217, 255, 0.2);
}

.toast.err {
  background: rgba(255, 107, 107, 0.12);
  border-color: rgba(255, 107, 107, 0.3);
  color: #ff6b6b;
  box-shadow: 0 8px 30px rgba(255, 107, 107, 0.2);
}

/* Typing indicator */
.typing {
  display: flex;
  gap: 6px;
  padding: 14px 16px;
  background: rgba(0, 217, 255, 0.08);
  border: 1px solid rgba(0, 217, 255, 0.2);
  border-radius: 16px;
  border-top-left-radius: 4px;
  width: fit-content;
  box-shadow: 0 4px 20px rgba(0, 217, 255, 0.15);
}

.td {
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
  animation: typingBounce 1.2s ease-in-out infinite;
  box-shadow: 0 0 10px currentColor;
}

.td:nth-child(2) {
  animation-delay: 0.2s;
}

.td:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typingBounce {
  0%, 60%, 100% { transform: translateY(0) scale(1); opacity: 0.6; }
  30% { transform: translateY(-10px) scale(1.1); opacity: 1; }
}

/* Cards and panels */
.qcard {
  background: linear-gradient(135deg, rgba(0, 217, 255, 0.08) 0%, rgba(124, 58, 237, 0.08) 100%);
  border: 1px solid rgba(0, 217, 255, 0.2);
  border-radius: 16px;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 14px;
  animation: cardSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 8px 30px rgba(0, 217, 255, 0.1);
  transition: all 0.3s ease;
}

@keyframes cardSlide {
  from {
    opacity: 0;
    transform: translateY(15px) scale(0.98);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

.qcard:hover {
  box-shadow: 0 12px 40px rgba(0, 217, 255, 0.2), inset 0 0 20px rgba(0, 217, 255, 0.05);
  border-color: rgba(0, 217, 255, 0.35);
}

.ptitle {
  font-family: var(--font-display);
  font-weight: 700;
  font-size: 15px;
  color: var(--text-primary);
  margin-bottom: 2px;
}

.psubtitle {
  font-size: 11px;
  color: var(--text-tertiary);
  font-family: var(--font-mono);
}

.pbtn {
  background: rgba(0, 217, 255, 0.08);
  border: 1px solid rgba(0, 217, 255, 0.2);
  color: var(--text-secondary);
  border-radius: 10px;
  padding: 12px 14px;
  cursor: pointer;
  font-size: 13px;
  transition: all 0.3s ease;
  text-align: left;
  font-family: var(--font-body);
  position: relative;
  overflow: hidden;
  font-weight: 500;
}

.pbtn::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: linear-gradient(180deg, var(--accent-primary), var(--accent-secondary));
  transform: scaleY(0);
  transition: transform 0.3s ease;
  border-radius: 0 2px 2px 0;
}

.pbtn:hover {
  background: rgba(0, 217, 255, 0.15);
  border-color: var(--accent-primary);
  color: var(--text-primary);
  padding-left: 18px;
  box-shadow: 0 4px 20px rgba(0, 217, 255, 0.2);
}

.pbtn:hover::before {
  transform: scaleY(1);
}

.pbtn-sub {
  font-size: 11px;
  color: var(--text-tertiary);
  margin-top: 4px;
  display: block;
  font-family: var(--font-mono);
}

/* Graph container */
.graph-container {
  background: rgba(0, 0, 0, 0.3);
  border: 1px solid rgba(0, 217, 255, 0.2);
  border-radius: 12px;
  padding: 14px;
  margin: 8px 0;
  width: 100%;
  height: 400px;
  position: relative;
}

/* Mobile */
@media(max-width:700px) {
  #sidebar {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    z-index: 100;
    transform: translateX(-100%);
    width: 260px;
  }
  
  #sidebar.open {
    transform: translateX(0);
    box-shadow: 4px 0 30px rgba(0, 217, 255, 0.3);
  }
  
  #menu-toggle {
    display: flex;
  }
  
  .bubble {
    max-width: 90%;
  }
  
  #welcome h1 {
    font-size: 26px;
  }
  
  #inputarea {
    padding: 12px 16px 14px;
  }
  
  .inp-wrap {
    padding: 9px 10px 9px 12px;
  }
  
  #input {
    font-size: 13px;
  }
  
  .graph-container {
    height: 300px;
  }
}
</style>
</head>
<body>
<!-- Mathematical symbols floating in background -->
<div id="particles"></div>

<div id="app">

<!-- â•â•â•â• SIDEBAR â•â•â•â• -->
<nav id="sidebar">
  <div class="logo-wrap">
    <div class="logo-icon">âˆ‘</div>
    <div>
      <div class="logo-name">MathSphere</div>
      <div class="logo-by">The Mathematical Lab</div>
    </div>
  </div>

  <div class="sb-scroll">
    <div class="sb-section">ğŸ§® Core Learning</div>
    <button class="nav-btn active" id="nav-ask" onclick="setMode('ask')">
      <span class="em">ğŸ’¬</span>Ask Anupam
    </button>
    <button class="nav-btn" id="nav-formula" onclick="setMode('formula')">
      <span class="em">ğŸ“Š</span>Formula Sheet
    </button>
    <button class="nav-btn" id="nav-graph" onclick="setMode('graph')">
      <span class="em">ğŸ“ˆ</span>Graph Plotter
    </button>

    <div class="sb-section">ğŸ”¬ Explore</div>
    <button class="nav-btn" id="nav-mathematician" onclick="setMode('mathematician')">
      <span class="em">ğŸ‘¨â€ğŸ”¬</span>Mathematicians
    </button>
    <button class="nav-btn" id="nav-projects" onclick="setMode('projects')">
      <span class="em">ğŸš€</span>Projects
    </button>
    <button class="nav-btn" id="nav-theorem" onclick="setMode('theorem')">
      <span class="em">ğŸ“</span>Theorems
    </button>
    <button class="nav-btn" id="nav-competition" onclick="setMode('competition')">
      <span class="em">ğŸ†</span>Competitions
    </button>

    <div class="sb-section">ğŸ“š Practice</div>
    <button class="nav-btn" id="nav-quiz" onclick="setMode('quiz')">
      <span class="em">ğŸ“</span>Quiz Mode
    </button>
    <button class="nav-btn" id="nav-mocktest" onclick="setMode('mocktest')">
      <span class="em">ğŸ§ª</span>Mock Test
    </button>
    <button class="nav-btn" id="nav-pyq" onclick="setMode('pyq')">
      <span class="em">ğŸ“œ</span>PYQ Bank
    </button>
  </div>

  <div style="padding:12px 10px;border-top:1px solid rgba(0,217,255,.1);display:flex;gap:7px;flex-wrap:wrap">
    <a class="soc-link" href="https://youtube.com/@pi_nomenal1729" target="_blank" style="flex:1;text-align:center;padding:8px;background:rgba(0,217,255,.08);border:1px solid rgba(0,217,255,.2);border-radius:8px;color:var(--text-secondary);text-decoration:none;font-size:11px;transition:all .3s;cursor:pointer">YouTube</a>
    <a class="soc-link" href="https://www.anupamnigam.com" target="_blank" style="flex:1;text-align:center;padding:8px;background:rgba(0,217,255,.08);border:1px solid rgba(0,217,255,.2);border-radius:8px;color:var(--text-secondary);text-decoration:none;font-size:11px;transition:all .3s;cursor:pointer">Website</a>
  </div>
</nav>

<!-- â•â•â•â• MAIN â•â•â•â• -->
<div id="main">
  <div id="topbar">
    <button id="menu-toggle" onclick="toggleSidebar()" style="display:none;background:rgba(0,217,255,.1);border:1px solid rgba(0,217,255,.2);color:var(--text-secondary);width:36px;height:36px;border-radius:8px;cursor:pointer;font-size:16px;align-items:center;justify-content:center;transition:all .3s">â˜°</button>
    <div id="mode-title">ğŸ’¬ Ask Anupam</div>
    <div class="status-dot"></div>
    <span style="font-size:10px;color:var(--text-tertiary);font-family:var(--font-mono);letter-spacing:1px">LIVE</span>
    <span id="owner-name">Anupam Nigam</span>
    <button id="theme-btn" onclick="toggleTheme()">ğŸŒ™ Dark</button>
    <button id="clear-btn" onclick="clearAll()">CLEAR</button>
  </div>
  <div id="tagsbar"></div>
  <div id="chat"></div>
  <div id="inputarea">
    <div style="display:none;margin-bottom:10px;position:relative" id="imgpreview">
      <img id="prev-img" src="" alt="" style="width:70px;height:52px;object-fit:cover;border-radius:8px;border:1px solid rgba(0,217,255,.3)"/>
      <button onclick="removeImg()" style="position:absolute;top:-6px;right:-6px;width:18px;height:18px;background:var(--danger);border-radius:50%;border:none;color:white;font-size:10px;cursor:pointer;display:flex;align-items:center;justify-content:center">âœ•</button>
    </div>
    <div class="inp-wrap">
      <textarea id="input" rows="1" placeholder="Ask any math question..." onkeydown="handleKey(event)" oninput="autoResize(this)" style="font-weight:500"></textarea>
      <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
        <input type="file" id="filein" accept="image/*" style="display:none" onchange="handleImg(event)"/>
        <button class="iico" onclick="document.getElementById('filein').click()" title="Upload image">ğŸ“¸</button>
        <button id="send-btn" onclick="sendMsg()">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="inp-hint">MathSphere v8.0 Â· The Mathematical Lab Â· By Anupam Nigam</div>
  </div>
</div>

</div>

<script>
/* â•â•â•â• Initialize particles â•â•â•â• */
(()=>{
  const syms=['âˆ«','âˆ‘','Ï€','âˆ','âˆš','âˆ‚','âˆ‡','Î»','Î”','Î¸','Î±','Î²','Î³','Îµ','â‰ ','â‰ˆ','Â±','âŠ•','â„','â„¤','âˆ…','âˆˆ','âˆ‰','âŠ†','âŠ‚'];
  for(let i=0;i<15;i++){
    const p=document.createElement('div');
    p.className='math-float';
    p.textContent=syms[Math.floor(Math.random()*syms.length)];
    p.style.cssText=`left:${Math.random()*100}%;top:${Math.random()*100}%;animation-duration:${20+Math.random()*20}s;animation-delay:${-Math.random()*20}s`;
    document.body.appendChild(p);
  }
})();

/* â•â•â•â• KaTeX Rendering â•â•â•â• */
function renderMath(el){
  if(!el||typeof renderMathInElement==='undefined')return;
  try{
    renderMathInElement(el,{
      delimiters:[
        {left:'\\[',right:'\\]',display:true},
        {left:'\\(',right:'\\)',display:false},
        {left:'$$',right:'$$',display:true},
        {left:'$',right:'$',display:false}
      ],throwOnError:false,errorColor:'#ff6b6b',strict:false
    });
  }catch(e){}
}

/* â•â•â•â• STATE â•â•â•â• */
let mode='ask',chatHistory=[],imgB64=null,imgType=null,busy=false;

const MODE_CFG={
  ask:{title:'ğŸ’¬ Ask Anupam',ph:'Ask any mathematics question...'},
  formula:{title:'ğŸ“Š Formula Sheet',ph:'Enter topic and exam level...'},
  graph:{title:'ğŸ“ˆ Graph Plotter',ph:'Enter function (e.g., x^2, sin(x))...'},
  mathematician:{title:'ğŸ‘¨â€ğŸ”¬ Mathematicians',ph:'Type a mathematician name...'},
  projects:{title:'ğŸš€ Projects',ph:'Enter mathematics topic...'},
  theorem:{title:'ğŸ“ Theorems',ph:'Enter theorem name...'},
  competition:{title:'ğŸ† Competitions',ph:''},
  quiz:{title:'ğŸ“ Quiz Mode',ph:''},
  mocktest:{title:'ğŸ§ª Mock Test',ph:''},
  pyq:{title:'ğŸ“œ PYQ Bank',ph:''},
};

window.onload=()=>{initTheme();setMode('ask');renderTagsBar();showWelcome();};

function setMode(m){
  mode=m;
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  const nb=document.getElementById(`nav-${m}`);if(nb)nb.classList.add('active');
  const cfg=MODE_CFG[m]||MODE_CFG.ask;
  const mt=document.getElementById('mode-title');
  mt.style.opacity='0';
  setTimeout(()=>{mt.textContent=cfg.title;mt.style.opacity='1';},150);
  document.getElementById('input').placeholder=cfg.ph||'Type here...';
  document.getElementById('sidebar').classList.remove('open');
  renderTagsBar();
  clearAll();
}

function clearAll(){chatHistory=[];imgB64=null;imgType=null;removeImg();showWelcome();}
function rmWelcome(){const w=document.getElementById('welcome');if(w)w.remove();}
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('open');}

document.addEventListener('click',e=>{
  const sb=document.getElementById('sidebar');
  if(window.innerWidth<=700&&sb.classList.contains('open')&&
     !sb.contains(e.target)&&!document.getElementById('menu-toggle').contains(e.target))
    sb.classList.remove('open');
});

function renderTagsBar(){
  const bar=document.getElementById('tagsbar');
  const tags={
    ask:[['Solve Integral','Solve: âˆ« xÂ² sin(x) dx'],
         ['Eigenvalues','Find eigenvalues of [[2,1],[1,2]]'],
         ['Series Test','Test convergence of Î£ 1/nÂ²'],
         ['Matrix Inverse','Find inverse of [[1,2],[3,4]]']],
    formula:[['Calculus','Calculus'],['Linear Algebra','Linear Algebra'],['Real Analysis','Real Analysis']],
    graph:[['f(x)=xÂ²','x^2'],['f(x)=sin(x)','sin(x)'],['f(x)=e^x','exp(x)']],
    competition:[['IMO','IMO'],['PUTNAM','PUTNAM'],['AIME','AIME']],
    quiz:['Calculus','Linear Algebra','Real Analysis'],
    mocktest:['JAM','GATE','CSIR'],
    pyq:['JAM','GATE','CSIR'],
  };
  if(!tags[mode]){bar.innerHTML='';return;}
  bar.innerHTML=tags[mode].map(item=>{
    const label=Array.isArray(item)?item[0]:item;
    const val=Array.isArray(item)?item[1]:item;
    if(mode==='competition')return`<div class="tag" onclick="toast('Competition problems coming soon','info')">${label}</div>`;
    if(mode==='quiz')return`<div class="tag" onclick="toast('Quiz mode coming soon','info')">${label}</div>`;
    return`<div class="tag" onclick="quickSend('${escQ(val||label)}')">${label}</div>`;
  }).join('');
}

function showWelcome(){
  document.getElementById('chat').innerHTML=`
  <div id="welcome">
    <div class="big-icon">âˆ‘</div>
    <h1>MathSphere</h1>
    <p>Your premium AI mathematics laboratory. Solve problems, explore mathematicians, prove theorems, and master mathematics with advanced AI guidance.</p>
    <div class="feat-grid">
      <div class="feat">âœ¨ Natural Chat</div>
      <div class="feat">ğŸ“Š Formula Sheets</div>
      <div class="feat">ğŸ“ˆ Graph Plotting</div>
      <div class="feat">ğŸ‘¨â€ğŸ”¬ Math Explorers</div>
      <div class="feat">ğŸš€ Real Projects</div>
      <div class="feat">ğŸ“ Theorem Proofs</div>
      <div class="feat">ğŸ† Competitions</div>
      <div class="feat">ğŸ“ Quiz Mode</div>
      <div class="feat new">âš¡ 30 Mock Tests</div>
      <div class="feat new">ğŸ“¸ Image Solving</div>
      <div class="feat new">ğŸ¯ Verified Answers</div>
      <div class="feat new">ğŸ’¡ Multiple Methods</div>
    </div>
  </div>`;
}

/* â•â•â•â• CHAT â•â•â•â• */
async function sendMsg(){
  const inp=document.getElementById('input');
  const text=inp.value.trim();
  if((!text&&!imgB64)||busy)return;
  rmWelcome();
  addMsg('user',text||'ğŸ“¸ Image uploaded');
  inp.value='';inp.style.height='auto';
  const curImg=imgB64,curType=imgType;removeImg();
  chatHistory.push({role:'user',content:text||'Solve this problem'});
  showTyping();
  try{
    const payload={messages:chatHistory.slice(-30)};
    if(curImg){payload.image_b64=curImg;payload.image_type=curType;}
    const r=await api('/api/chat',payload);
    hideTyping();
    chatHistory.push({role:'assistant',content:r.answer});
    addMsg('bot',r.answer);
  }catch(e){hideTyping();addMsg('bot','âš ï¸ Error: '+e.message,true);}
}

function addMsg(role,text,isErr=false){
  rmWelcome();
  const chat=document.getElementById('chat');
  const div=document.createElement('div');
  div.className=`msg ${role}`;
  div.innerHTML=`<div class="avatar">${role==='user'?'ğŸ‘¤':'âˆ‘'}</div><div class="bubble"></div>`;
  const bubble=div.querySelector('.bubble');
  bubble.innerHTML=fmt(text);
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
  requestAnimationFrame(()=>{renderMath(bubble);chat.scrollTop=chat.scrollHeight;});
}

function showTyping(){
  busy=true;
  const chat=document.getElementById('chat');
  const div=document.createElement('div');
  div.className='msg bot';
  div.id='typing-ind';
  div.innerHTML=`<div class="avatar">âˆ‘</div><div class="typing"><div class="td"></div><div class="td"></div><div class="td"></div></div>`;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}

function hideTyping(){
  busy=false;
  const t=document.getElementById('typing-ind');
  if(t)t.remove();
}

/* â•â•â•â• TEXT FORMATTING â•â•â•â• */
function fmt(text){
  if(!text)return'';
  const latexBlocks=[];
  let t=text;
  t=t.replace(/\\\[([\s\S]*?)\\\]/g,m=>{latexBlocks.push(m);return`\x00L${latexBlocks.length-1}\x00`;});
  t=t.replace(/\\\(([\s\S]*?)\\\)/g,m=>{latexBlocks.push(m);return`\x00L${latexBlocks.length-1}\x00`;});
  t=t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  t=t.replace(/\x00L(\d+)\x00/g,(_,i)=>latexBlocks[parseInt(i)]);
  t=t.replace(/```([\s\S]*?)```/g,'<pre>$1</pre>');
  t=t.replace(/\n/g,'<br>');
  return t;
}

function escHtml(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function escQ(s){return String(s||'').replace(/\\/g,'\\\\').replace(/'/g,"\\'");}
function autoResize(el){el.style.height='auto';el.style.height=Math.min(el.scrollHeight,120)+'px';}
function handleKey(e){if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg();}}
async function quickSend(msg){document.getElementById('input').value=msg;await sendMsg();}
async function api(url,data){
  const r=await fetch(url,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
  if(!r.ok)throw new Error(`Error ${r.status}`);
  return r.json();
}

function toast(msg,type='ok'){
  const t=document.createElement('div');
  t.className=`toast ${type}`;
  t.textContent=msg;
  document.body.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';setTimeout(()=>t.remove(),300);},2000);
}

function handleImg(e){
  const file=e.target.files[0];if(!file)return;
  const r=new FileReader();
  r.onload=ev=>{
    const res=ev.target.result;
    imgB64=res.split(',')[1];
    imgType=file.type;
    document.getElementById('prev-img').src=res;
    document.getElementById('imgpreview').style.display='block';
  };
  r.readAsDataURL(file);
}

function removeImg(){
  imgB64=null;imgType=null;
  document.getElementById('imgpreview').style.display='none';
  document.getElementById('filein').value='';
}

function initTheme(){
  const t=localStorage.getItem('ms_theme')||'dark';
  document.body.classList.toggle('light',t==='light');
  document.getElementById('theme-btn').textContent=t==='light'?'â˜€ï¸ Light':'ğŸŒ™ Dark';
}

function toggleTheme(){
  const nowLight=!document.body.classList.contains('light');
  document.body.classList.toggle('light',nowLight);
  localStorage.setItem('ms_theme',nowLight?'light':'dark');
  document.getElementById('theme-btn').textContent=nowLight?'â˜€ï¸ Light':'ğŸŒ™ Dark';
}
</script>
</body>
</html>